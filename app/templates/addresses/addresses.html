{% extends 'base.html' %}

{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block js %}
    <script src="{% static 'js/addresses.js' %}"></script>
{% endblock %}

{% block content %}
    <h1>{% trans 'Addresses' %}</h1>
    <button class="btn btn-primary mb-3" onclick="onAddAddressClicked(event)">
        <i class="fa fa-plus"></i>
        {% trans 'Add Address' %}
    </button>
    <table id="addresses-table" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">{% trans 'Street' %}</th>
                <th scope="col">{% trans 'City' %}</th>
                <th scope="col">{% trans 'Postal Code' %}</th>
                <th scope="col">{% trans 'Country' %}</th>
                <th scope="col">{% trans 'Actions' %}</th>
            </tr>
        </thead>
        <tbody>
        {% for address in addresses %}
            <tr data-id="{{ address.pk }}">
                <td>{{ address.street }} {{ address.number }}</td>
                <td>{{ address.city }}</td>
                <td>{{ address.postal_code }}</td>
                <td>
                    <img 
                        src="{{ address.country.get_flag_url }}"
                        alt="{{ address.country.name }}"
                        style="width: 25px;"
                    >
                    {{ address.country }}
                </td>
                <td>
                    <button 
                        class="btn btn-sm btn-close" 
                        title="{% trans 'Edit' %}"
                        data-id="{{ address.id }}"
                        onclick="onEditAddressClicked(event)"
                    >
                        <i class="fa fa-edit"></i>
                    </button>
                    <button 
                        class="btn btn-sm btn-close" 
                        title="{% trans 'Delete' %}"
                        data-id="{{ address.id }}"
                        onclick="onDeleteAddressClicked(event)"
                    >
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            </tr>
        {% endfor %}
    </tbody>


    <dialog id="add-address-dialog" name="add-address-dialog">
        <div class="content">
            <header>
                <h1>{% trans 'Add Address' %}</h1>
            </header>
            <div class="body">
                <form id="address-form" onsubmit="onAddressFormSubmitted(event)">
                    <input name="id" type="hidden">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="col-md">
                            {{ create_address_form.street|as_crispy_field }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-md-6">
                            {{ create_address_form.number|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ create_address_form.additional_info|as_crispy_field }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-md-6">
                            {{ create_address_form.postal_code|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ create_address_form.city|as_crispy_field }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-md-6">
                            {{ create_address_form.region|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ create_address_form.country|as_crispy_field }}
                        </div>
                    </div>
                </form>
            </div>
            <footer>
                <button class="btn btn-primary" type="submit" form="address-form">
                    <i class="fa fa-save mr-2"></i>
                    {% trans 'Save address' %}
                </button>
                <button class="btn btn-danger" type="cancel">
                    <i class="fa fa-xmark mr-2"></i>
                    {% trans 'Cancel' %}
                </button>
            </footer>
        </div>
    </dialog>

    <template id="address-template">
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>
                <button 
                    class="btn btn-sm btn-close" 
                    title="{% trans 'Edit' %}"
                    onclick="onEditAddressClicked(event)"
                >
                    <i class="fa fa-edit"></i>
                </button>
                <button 
                    class="btn btn-sm btn-close" 
                    title="{% trans 'Delete' %}"
                    onclick="onDeleteAddressClicked(event)"
                >
                    <i class="fa fa-trash"></i>
                </button>
            </td>
        </tr>
    </template>

    <script>
        CSRF_MIDDLEWARE_TOKEN = "{{ csrf_token }}";

        CREATE_ADDRESS_URL = "{% url 'create_address' %}";
        GET_ADDRESS_URL = "{% url 'edit_address' 0 %}";
        EDIT_ADDRESS_URL = GET_ADDRESS_URL;
        DELETE_ADDRESS_URL = GET_ADDRESS_URL;
    </script>
{% endblock %}